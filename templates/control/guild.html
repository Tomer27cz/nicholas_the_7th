{% extends "base/base.html" %}

{% set title = 'Control Panel' %}

{% block nav %}

  {% if not guild.connected %}
    <div class="alert alert-warning div-align fade show sticky-top" role="alert">
      {{ tg(gi, 'Bot is not connected to this guild -> Disabled') }}
    </div>
  {% endif %}

  {% if errors %}
    {% for error in errors %}
      <div class="alert alert-danger div-align alert-dismissible fade show sticky-top" role="alert">
        {{ error }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-success div-align alert-dismissible fade show sticky-top" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}

{% endblock %}


{% block content %}
  <!-- Guild -->
  <div>
    <div class="div-align margin-bottom-1">
      <div class="accordion" id="accordionFlushExample">
        <div class="accordion-item">
          <div class="accordion-header div-options">
            <button class="btn btn-dark btn-options" data-bs-toggle="modal" data-bs-target="#optionsModal"
                    title="{{ tg(gi, 'Server Options') }}">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                <path
                    d="M14 7V9C14 9 12.5867 9 12.5733 9.00667C12.42 9.58667 12.1733 10.1267 11.84 10.6067L12.74 11.5067L11.4933 12.7533L10.5933 11.8533C10.1133 12.1867 9.57334 12.44 8.99334 12.5867V14H6.99334V12.58C6.41334 12.4333 5.87334 12.18 5.39334 11.8467L4.49333 12.7467L3.24667 11.5L4.14667 10.6C3.81333 10.1267 3.56 9.58 3.41333 9H2V7H3.41333C3.56 6.42 3.81333 5.88 4.14667 5.4L3.24667 4.5L4.5 3.24667L5.4 4.14667C5.87334 3.81333 6.42 3.56 7 3.41333V2H9V3.41333C9.58 3.56667 10.12 3.81333 10.6 4.14667L11.5067 3.25333L12.7533 4.5L11.8533 5.4C12.1867 5.87334 12.44 6.42 12.5867 7H14ZM8 10C9.10457 10 10 9.10457 10 8C10 6.89543 9.10457 6 8 6C6.89543 6 6 6.89543 6 8C6 9.10457 6.89543 10 8 10Z"></path>
              </svg>
            </button>
            <div class="d-grid gap-2">
              <a class="btn btn-dark" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne"
                 aria-expanded="false" aria-controls="flush-collapseOne">
                <h2>{{ guild.data.name }}</h2>
              </a>
            </div>
          </div>
          <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
            <div class="q-container">
              <div class="q-div">
                {% if guild.data.icon is not none %}
                  <img loading="lazy" class="q-img" src="{{ guild.data.icon }}" alt="thumbnail">
                {% else %}
                  None
                {% endif %}
                <div class="q-item1 q-wa">
                  <p class="q-text q-1">{{ tg(gi, 'Member Count') }}</p>
                  <p class="q-text q-2">{{ guild.data.member_count }}</p>
                </div>
                <div class="q-item1 q-wa">
                  <p class="q-text q-1">ID</p>
                  <p class="q-text q-2">{{ guild.data.id }}</p>
                </div>
                <div class="q-item1 q-items-center">
                  <p class="q-text q-1">{{ tg(gi, 'Server Owner') }}</p>
                  <p class="q-text q-2"><a class="q-2" target="_blank" rel="noopener noreferrer"
                                           href="https://discordapp.com/users/{{ guild.data.owner_id }}">{{ guild.data.owner_name }}</a>
                  </p>
                  <p class="q-text q-3">{{ guild.data.owner_id }}</p>
                </div>
                <div class="q-item1 q-wa">
                  <p class="q-text q-1">{{ tg(gi, 'Created at') }}</p>
                  <p class="q-text q-2">{{ struct_to_time(guild.data.created_at) }}</p>
                </div>
                <div class="q-item1 q-wa">
                  <p class="q-text q-1">{{ tg(gi, 'Description') }}</p>
                  <p class="q-text q-2">{{ guild.data.description }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Now and History -->
  <div class="accordion" id="accordionPanelsStayOpenExample">
    <div class="accordion-item">
      <div class="accordion-header">
        <div class="d-grid gap-2">
          <a class="btn btn-dark accordion-button collapsed" type="button" data-bs-toggle="collapse"
             data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="false"
             aria-controls="panelsStayOpen-collapseOne">
            <h3>{{ tg(gi, 'History') }}</h3>
          </a>
        </div>
      </div>
      <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse">
        <div class="accordion-body">
          {% if guild.history %}
            {% for track in guild.history %}
              <div class="q-div q-history">
                <img loading="lazy" class="q-img" src="{{ track.picture }}" alt="thumbnail">
                <div class="q-item1 q-wd">
                  <p class="q-text"><a class="q-1" target="_blank" rel="noopener noreferrer"
                                       href="{{ track.url }}">{{ track.title }}</a></p>
                  <p class="q-text"><a class="q-2" target="_blank" rel="noopener noreferrer"
                                       href="{{ track.channel_link }}">{{ track.channel_name }}</a></p>
                  <p class="q-text q-3">{{ convert_duration(track.duration) }}</p>
                </div>
                <div class="q-item3 q-items-center">
                  <p class="q-text q-1">{{ tg(gi, 'From/To') }}</p>
                  <p class="q-text q-2">{{ struct_to_time(track.played_duration[0]['start']['epoch'], first='time') }}</p>
                  <p class="q-text q-2">{{ struct_to_time(track.played_duration[-1]['end']['epoch'], first='time') }}</p>
                </div>
                <div class="q-item2 q-items-center">
                  <p class="q-text"><a class="q-1" target="_blank" rel="noopener noreferrer"
                                       href="https://discordapp.com/users/{{ track.author }}">{{ get_username(track.author) }}</a>
                  </p>
                  <p class="q-text q-2">{{ track.author }}</p>
                  <p class="q-text q-3">{{ struct_to_time(track.created_at, first='time') }}</p>
                </div>
                <div class="q-item0 q-wa q-self-center q-items-center">
                  <form method="POST" action="" onsubmit="setScroll();">
                    <input type="hidden" name="scroll" value="0" id="scrollPos1">
                    {% if admin == True %}
                      <button class="btn btn-outline btn-primary btn-sm btn-m" type="button" data-bs-toggle="modal"
                              data-bs-target=#videoEditModal_h{{ guild.history.index(track) }}>{{ tg(gi, 'Edit') }}</button>
                      <button class="btn btn-outline btn-danger btn-sm btn-m" type="submit"
                              value="h{{ guild.history.index(track) }}" name="hdel_btn">{{ tg(gi, 'Remove') }}</button>
                    {% endif %}
                    <button type="button" class="btn btn-secondary btn-sm dropdown-toggle btn-m"
                            data-bs-toggle="dropdown" aria-expanded="false">{{ tg(gi, 'More') }}</button>
                    <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end">
                      <li>
                        <button class="dropdown-item" type="submit" name="queue_btn"
                                value="h{{ guild.history.index(track) }}">{{ tg(gi, 'Add to queue') }}</button>
                      </li>
                      <li>
                        <button class="dropdown-item" type="submit" name="nextup_btn"
                                value="h{{ guild.history.index(track) }}">{{ tg(gi, 'Play next') }}</button>
                      </li>
                      <li>
                        <hr class="dropdown-divider">
                      </li>
                      <li>
                        <button class="dropdown-item" type="button" data-bs-toggle="modal"
                                data-bs-target=#videoModal_h{{ guild.history.index(track) }}>{{ tg(gi, 'Info') }}</button>
                      </li>
                    </ul>
                  </form>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <div class="div-align">
              <p>{{ tg(gi, 'Nothing has been played yet') }}</p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="accordion-item">
      <div class="accordion-header">
        <div class="d-grid gap-2">
          <a class="btn btn-dark accordion-button" type="button" data-bs-toggle="collapse"
             data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="true"
             aria-controls="panelsStayOpen-collapseTwo">
            <h3>{{ tg(gi, 'Now Playing') }}</h3>
          </a>
        </div>
      </div>
      <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse show">
        <div class="accordion-body">
          {% if guild.now_playing is not none %}
            <div class="q-div q-history">
              {% if guild.now_playing.radio_info is not none and 'picture' in guild.now_playing.radio_info.keys() %}
              <div class="q-item0 q-div div-radio3">
                <img loading="lazy" class="q-img" src="{{ guild.now_playing.radio_info['picture'] }}" alt="thumbnail">
                <div class="q-item1 q-wd">
                  <p class="q-text"><a class="q-1" target="_blank" rel="noopener noreferrer" href="{{ guild.now_playing.url }}">{{ guild.now_playing.radio_info['title'] }}</a></p>
                  <p class="q-text"><a class="q-2" target="_blank" rel="noopener noreferrer" href="{{ guild.now_playing.channel_link }}">{{ guild.now_playing.radio_info['channel_name'] }}</a></p>
                </div>
              </div>
              {% endif %}
              <img loading="lazy" class="q-img" src="{{ guild.now_playing.picture }}" alt="thumbnail">
              <div class="q-item1">
                <p class="q-text"><a class="q-1" target="_blank" rel="noopener noreferrer"
                                     href="{{ guild.now_playing.url }}">{{ guild.now_playing.title }}</a></p>
                <p class="q-text"><a class="q-2" target="_blank" rel="noopener noreferrer"
                                     href="{{ guild.now_playing.channel_link }}">{{ guild.now_playing.channel_name }}</a>
                </p>
                <p class="q-text q-3">{{ convert_duration(guild.now_playing.duration) }}</p>
              </div>
              <div class="q-item3 q-items-center">
                <p class="q-text q-1">{{ tg(gi, 'Played at') }}</p>
                <p class="q-text q-2">{{ struct_to_time(guild.now_playing.played_duration[0]['start']['epoch'], first='time') }}</p>
              </div>
              <div class="q-item2 q-items-center">
                <p class="q-text"><a class="q-1" target="_blank" rel="noopener noreferrer"
                                     href="https://discordapp.com/users/{{ guild.now_playing.author }}">{{ get_username(guild.now_playing.author) }}</a>
                </p>
                <p class="q-text q-2">{{ guild.now_playing.author }}</p>
                <p class="q-text q-3">{{ struct_to_time(guild.now_playing.created_at, first='time') }}</p>
              </div>
              <div class="q-item0 q-wa q-self-center q-items-center">
                <form method="POST" action="" onsubmit="setScroll();">
                  <input type="hidden" name="scroll" value="0" id="scrollPos2">
                  {% if admin == True %}
                    <button class="btn btn-outline btn-primary btn-sm btn-m" type="button" data-bs-toggle="modal"
                            data-bs-target=#videoEditModal_np>{{ tg(gi, 'Edit') }}</button>
                  {% endif %}
                  <button type="button" class="btn btn-secondary btn-sm dropdown-toggle btn-m" data-bs-toggle="dropdown"
                          aria-expanded="false">{{ tg(gi, 'More') }}</button>
                  <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end">
                    <li>
                      <button class="dropdown-item" type="submit" name="queue_btn"
                              value="np">{{ tg(gi, 'Add to queue') }}</button>
                    </li>
                    <li>
                      <button class="dropdown-item" type="submit" name="nextup_btn"
                              value="np">{{ tg(gi, 'Play next') }}</button>
                    </li>
                    <li>
                      <hr class="dropdown-divider">
                    </li>
                    <li>
                      <button class="dropdown-item" type="button" data-bs-toggle="modal"
                              data-bs-target=#videoModal_np>{{ tg(gi, 'Info') }}</button>
                    </li>
                  </ul>
                </form>
              </div>
            </div>
            <div>
              {% if guild.now_playing.chapters %}
                <div class="p-div-m">
                  {% for chapter in guild.now_playing.chapters %}
                    <div class="vr"></div>

                    <label for="chapter-checkbox{{ chapter['start_time'] }}" class="p-bar p-ch"
                           style="width: {{ ((chapter['end_time'] - chapter['start_time']) / int(guild.now_playing.duration))*100 }}%">
                      <input  type="radio" name="chapter-checkbox" id="chapter-checkbox{{ chapter['start_time'] }}">
                        <div class="p-text">
                          <form method="POST" action="" onsubmit="setScroll();">
                            <input type="hidden" name="scroll" value="0" id="scrollPos13">
                            <div class="ch-div">
                              {{ chapter['title'] }} ({{ convert_duration(chapter['start_time']) }} - {{ convert_duration(chapter['end_time']) }})
                              <button type="submit" class="btn btn-primary btn-sm" name="jump_btn" value={{ chapter['start_time'] }}>{{ tg(gi, 'Jump') }}</button>
                            </div>
                          </form>
                        </div>
                      </input>
                    </label>

                  {% endfor %}
                </div>
              {% endif %}
              {% if check_isdigit(guild.now_playing.duration) %}
                <div class="p-div">
                  <div class="p-bar"
                       style="width: {{ (video_time_played(guild.now_playing) / int(guild.now_playing.duration))*100 }}%"
                       id="np_progress"></div>
                </div>
              {% else %}
                <div class="p-div">
                  <div class="p-bar" style="width: 100%"></div>
                </div>
              {% endif %}
            </div>
          {% else %}
            <div class="div-align">
              <p>{{ tg(gi, 'Nothing is playing right now') }}</p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Control -->
  <form action="" method="POST" onsubmit="setScroll();">
    <input type="hidden" name="scroll" value="0" id="scrollPos3">
    <div class="q-div div-con">
      <div class="q-item0 div-align-center">
        <h4><span id="progress_time">0:00</span> / {% if guild.now_playing %}{{ convert_duration(guild.now_playing.duration) }}{% else %}0:00{% endif %}</h4>
      </div>
      <div class="q-item1">
        <div class="e-div">
          <button class="btn btn-dark e-item1" type="submit" name="play_btn" title="{{ tg(gi, 'Play') }}"
                  {% if not guild.connected %}disabled{% endif %}>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#0d6efd" viewBox="0 0 384 512">
              <path
                  d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"></path>
            </svg>
          </button>
          <button class="btn btn-dark e-item1" type="submit" name="skip_btn" title="{{ tg(gi, 'Skip') }}"
                  {% if not guild.connected %}disabled{% endif %}>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 512 512">
              <path
                  d="M52.5 440.6c-9.5 7.9-22.8 9.7-34.1 4.4S0 428.4 0 416V96C0 83.6 7.2 72.3 18.4 67s24.5-3.6 34.1 4.4L224 214.3V256v41.7L52.5 440.6zM256 352V256 128 96c0-12.4 7.2-23.7 18.4-29s24.5-3.6 34.1 4.4l192 160c7.3 6.1 11.5 15.1 11.5 24.6s-4.2 18.5-11.5 24.6l-192 160c-9.5 7.9-22.8 9.7-34.1 4.4s-18.4-16.6-18.4-29V352z"></path>
            </svg>
          </button>
          <button class="btn btn-dark e-item1" type="submit" name="pause_btn" title="{{ tg(gi, 'Pause') }}"
                  {% if not guild.connected %}disabled{% endif %}>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 320 512">
              <path
                  d="M48 64C21.5 64 0 85.5 0 112V400c0 26.5 21.5 48 48 48H80c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48H48zm192 0c-26.5 0-48 21.5-48 48V400c0 26.5 21.5 48 48 48h32c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48H240z"></path>
            </svg>
          </button>
          <button class="btn btn-dark e-item1" type="submit" name="stop_btn" title="{{ tg(gi, 'Stop') }}"
                  {% if not guild.connected %}disabled{% endif %}>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#dc3545" viewBox="0 0 384 512">
              <path
                  d="M0 128C0 92.7 28.7 64 64 64H320c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128z"></path>
            </svg>
          </button>
        </div>
      </div>
      <div class="q-item1"></div>
      <div class="q-item1">
        <div class="e-div">
          <button class="btn btn-dark e-item1" type="button" data-bs-toggle="modal" data-bs-target="#joinModal"
                  title="{{ tg(gi, 'Join Channel') }}" {% if not guild.connected %}disabled{% endif %}>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#198754" viewBox="0 0 16 16">
              <path d="M14 2H16V3H14V5H13V3H11V2H13V0H14V2Z"></path>
              <path
                  d="M6.5 8.00667C7.88 8.00667 9 6.88667 9 5.50667C9 4.12667 7.88 3.00667 6.5 3.00667C5.12 3.00667 4 4.12667 4 5.50667C4 6.88667 5.12 8.00667 6.5 8.00667Z"></path>
              <path d="M6.5 8.34C3.26 8.34 1 9.98666 1 12.34V13.0067H12V12.34C12 9.98 9.74 8.34 6.5 8.34Z"></path>
            </svg>
          </button>
          <button class="btn btn-dark e-item1" type="submit" name="disconnect_btn" title="{{ tg(gi, 'Disconnect') }}"
                  {% if not guild.connected %}disabled{% endif %}>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#dc3545" viewBox="0 0 24 24">
              <path
                  d="M21.1169 1.11603L22.8839 2.88403L19.7679 6.00003L22.8839 9.11603L21.1169 10.884L17.9999 7.76803L14.8839 10.884L13.1169 9.11603L16.2329 6.00003L13.1169 2.88403L14.8839 1.11603L17.9999 4.23203L21.1169 1.11603ZM18 22H13C6.925 22 2 17.075 2 11V6C2 5.447 2.448 5 3 5H7C7.553 5 8 5.447 8 6V10C8 10.553 7.553 11 7 11H6C6.063 14.938 9 18 13 18V17C13 16.447 13.447 16 14 16H18C18.553 16 19 16.447 19 17V21C19 21.553 18.553 22 18 22Z"></path>
            </svg>
          </button>
        </div>
      </div>
      {% if admin == True %}
        <div class="d-flex">
          <div class="btn-m">
            <input style="width: 5rem" type="number" class="form-c form-control btn-m" name="timeInput" min="0" max="{{ guild.now_playing.duration }}" value="0" {% if not guild.connected %}disabled{% endif %}>
          </div>
          <button class="btn btn-outline btn-primary btn-sm btn-m" type="submit" name="time_btn" title="{{ tg(gi, 'Set Time') }}" {% if not guild.connected %}disabled{% endif %}>Set</button>

        </div>
        <div class="vr btm-m"></div>
      {% endif %}
      <div class="q-item1">
        <div class="d-flex">
          <div class="btn-m">
            <input type="number" class="form-c form-control btn-m flex-fill" name="volumeInput" min="0" max="200"
                   value="{{ int(guild.options.volume*100) }}" oninput="this.form.volumeRange.value=this.value"
                   {% if not guild.connected %}disabled{% endif %}>
          </div>
          <input type="range" class="form-r form-range btn-m" name="volumeRange" min="0" max="200" value="{{ int(guild.options.volume*100) }}"
                 oninput="this.form.volumeInput.value=this.value" {% if not guild.connected %}disabled{% endif %}>
          <button class="btn btn-outline btn-primary btn-sm btn-m flex-fill" type="submit" name="volume_btn"
                  title="{{ tg(gi, 'Set Volume') }}" {% if not guild.connected %}disabled{% endif %}>Set
          </button>
        </div>
      </div>
    </div>
  </form>

  <!-- Queue -->
  <div class="q-top">
    <div class="q-item1 l-div gap1">
      <h3>{{ tg(gi, 'Queue') }}</h3>
      <a class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#saveModal" title="{{ tg(gi, 'Save Queue') }}">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"></path>
        <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"></path>
      </svg>
    </a>
      <a class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#loadModal" title="{{ tg(gi, 'Load Queue') }}">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-upload" viewBox="0 0 16 16">
        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"></path>
        <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"></path>
      </svg>
    </a>
      {% if admin %}
        <a class="btn btn-primary" href="/admin/guild/{{ gi }}/saves">{{ tg(gi, 'Edit') }}</a>
      {% endif %}
    </div>
    <a class="q-top-add btn btn-dark" data-bs-toggle="modal" data-bs-target="#addToModal"
       title="{{ tg(gi, 'Add to queue') }}">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-plus-lg"
           viewBox="0 0 16 16">
        <path fill-rule="evenodd"
              d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"></path>
      </svg>
    </a>
    <form method="POST" action="#" onsubmit="setScroll();">
      <input type="hidden" name="scroll" value="0" id="scrollPos11">
      <button class="btn btn-dark" type="submit" name="loop_btn" title="{{ tg(gi, 'Loop') }}">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
             fill="{{ '#198754' if guild.options.loop else 'currentColor' }}" class="bi bi-arrow-repeat"
             viewBox="0 0 16 16">
          <path
              d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z"></path>
          <path fill-rule="evenodd"
                d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z"></path>
        </svg>
      </button>
      <button class="btn btn-dark" type="submit" name="shuffle_btn" title="{{ tg(gi, 'Shuffle') }}">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-shuffle"
             viewBox="0 0 16 16">
          <path fill-rule="evenodd"
                d="M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.624 9.624 0 0 0 7.556 8a9.624 9.624 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.595 10.595 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.624 9.624 0 0 0 6.444 8a9.624 9.624 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5z"></path>
          <path
              d="M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192zm0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192z"></path>
        </svg>
      </button>
      <button class="btn btn-dark" type="submit" name="clear_btn" title="{{ tg(gi, 'Clear') }}">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#dc3545" class="bi bi-trash"
             viewBox="0 0 16 16">
          <path
              d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"></path>
          <path
              d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"></path>
        </svg>
      </button>
    </form>
  </div>
  <form method="POST" action="" onsubmit="setScroll();">
    <input type="hidden" name="scroll" value="0" id="scrollPos4">
    <div class="q-main">
      {% if guild.queue %}
        {% for track in guild.queue %}
          <div class="q-container">
            <div class="q-div">
              {% if track.radio_info is not none and 'picture' in track.radio_info.keys() %}
              <div class="q-item0 q-div div-radio2 r-w1">
                <img loading="lazy" class="q-img" src="{{ track.radio_info['picture'] }}" alt="thumbnail">
                <div class="q-item1 q-wd">
                  <p class="q-text"><a class="q-1" target="_blank" rel="noopener noreferrer" href="{{ track.url }}">{{ track.radio_info['title'] }}</a></p>
                  <p class="q-text"><a class="q-2" target="_blank" rel="noopener noreferrer" href="{{ track.channel_link }}">{{ track.radio_info['channel_name'] }}</a></p>
                </div>
              </div>
              {% endif %}
              <img loading="lazy" class="q-img" src="{{ track.picture }}" alt="thumbnail">
              <div class="q-item1 {% if track.radio_info is not none and 'picture' in track.radio_info.keys() %}r-w2{% else %}q-wd{% endif %}">
                <p class="q-text"><a class="q-1" target="_blank" rel="noopener noreferrer" href="{{ track.url }}">{{ track.title }}</a></p>
                <p class="q-text"><a class="q-2" target="_blank" rel="noopener noreferrer" href="{{ track.channel_link }}">{{ track.channel_name }}</a></p>
                <p class="q-text q-3">{{ convert_duration(track.duration) }}</p>
              </div>
              <div class="q-item2 q-items-center">
                <p class="q-text"><a class="q-1" target="_blank" rel="noopener noreferrer"
                                     href="https://discordapp.com/users/{{ track.author }}">{{ get_username(track.author) }}</a>
                </p>
                <p class="q-text q-2">{{ track.author }}</p>
                <p class="q-text q-3">{{ struct_to_time(track.created_at, first='time') }}</p>
              </div>
              <div class="q-item0 q-wa q-self-center q-items-center">
                {% if admin == True %}
                  <button class="btn btn-outline btn-primary btn-sm btn-m" type="button" data-bs-toggle="modal"
                          data-bs-target=#videoEditModal_{{ guild.queue.index(track) }}>{{ tg(gi, 'Edit') }}</button>
                {% endif %}
                <button type="button" class="btn btn-secondary btn-sm dropdown-toggle btn-m" data-bs-toggle="dropdown"
                        aria-expanded="false">{{ tg(gi, 'More') }}</button>
                <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end">
                  <li>
                    <button class="dropdown-item" type="submit" name="top_btn"
                            value={{ guild.queue.index(track) }}>{{ tg(gi, 'Move to Top') }}</button>
                  </li>
                  <li>
                    <button class="dropdown-item" type="submit" name="bottom_btn"
                            value={{ guild.queue.index(track) }}>{{ tg(gi, 'Move to Bottom') }}</button>
                  </li>
                  <li>
                    <hr class="dropdown-divider">
                  </li>
                  <li>
                    <button class="dropdown-item" type="submit" name="duplicate_btn"
                            value={{ guild.queue.index(track) }}>{{ tg(gi, 'Duplicate') }}</button>
                  </li>
                  <li>
                    <hr class="dropdown-divider">
                  </li>
                  <li>
                    <button class="dropdown-item" type="button" data-bs-toggle="modal"
                            data-bs-target=#videoModal_{{ guild.queue.index(track) }}>{{ tg(gi, 'Info') }}</button>
                  </li>
                </ul>
                <button class="btn btn-outline btn-danger btn-sm btn-m" type="submit" name="del_btn"
                        value="{{ guild.queue.index(track) }}">{{ tg(gi, 'Remove') }}</button>
              </div>
            </div>
            <div class="q-item0 q-wa q-self-center q-items-center">
              <div class="btn-group-vertical">
                <button class="btn btn-dark" name="up_btn" value={{ guild.queue.index(track) }}>
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                       class="bi bi-arrow-up" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                          d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z"></path>
                  </svg>
                </button>
                <button class="btn btn-dark" name="down_btn" value={{ guild.queue.index(track) }}>
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                       class="bi bi-arrow-down" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                          d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1z"></path>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="div-align">
          <p>{{ tg(gi, 'There is nothing in the queue') }}</p>
        </div>
      {% endif %}
    </div>
  </form>

  <!-- Video Modals -->
  {% for track in guild.queue %}
    <div class="modal fade" id="videoModal_{{ guild.queue.index(track) }}" data-bs-keyboard="false" tabindex="-1"
         aria-labelledby="videoLabel_{{ guild.queue.index(track) }}" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg r-modal">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5"
                id="videoLabel_{{ guild.queue.index(track) }}">{{ tg(gi, 'Video') }} {{ guild.queue.index(track) }} {{ tg(gi, 'Info') }}</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="info-modal">
            <br>
            <p>index: <span class="v-info">{{ guild.queue.index(track) }}</span></p>
            {% for key, value in track.__dict__.items() %}
              <p>{{ key }}: <span class="v-info">{{ value }}</span></p>
            {% endfor %}
            <br>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}

  <!-- Video History Modals -->
  {% for track in guild.history %}
    <div class="modal fade" id="videoModal_h{{ guild.history.index(track) }}" data-bs-keyboard="false" tabindex="-1"
         aria-labelledby="videoLabel_h{{ guild.history.index(track) }}" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg r-modal">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5"
                id="videoLabel_h{{ guild.history.index(track) }}">{{ tg(gi, 'Video History') }} {{ guild.history.index(track) }} {{ tg(gi, 'Info') }}</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="info-modal">
            <br>
            <p>index: <span class="v-info">{{ guild.history.index(track) }}</span></p>
            {% for key, value in track.__dict__.items() %}
              <p>{{ key }}: <span class="v-info">{{ value }}</span></p>
            {% endfor %}
            <br>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}

  <!--Now Playing Modal-->
  {% if guild.now_playing %}
    <div class="modal fade" id="videoModal_np" data-bs-keyboard="false" tabindex="-1" aria-labelledby="videoLabel_np"
         aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl r-modal">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="videoLabel_np">{{ tg(gi, 'Video Now Playing Info') }}</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="info-modal">
            <br>
            {% for key, value in guild.now_playing.__dict__.items() %}
              <p>{{ key }}: <span class="v-info">{{ value }}</span></p>
            {% endfor %}
            <br>
          </div>
        </div>
      </div>
    </div>
  {% endif %}

  <!-- Video Edit Modals -->
  {% if admin == True %}
    {% for track in guild.queue %}
      <div class="modal fade" id="videoEditModal_{{ guild.queue.index(track) }}" data-bs-keyboard="false" tabindex="-1"
           aria-labelledby="videoEditLabel_{{ guild.queue.index(track) }}" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg r-modal">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5"
                  id="videoEditLabel_{{ guild.queue.index(track) }}">{{ tg(gi, 'Video') }} {{ guild.queue.index(track) }} {{ tg(gi, 'Edit') }}</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="info-modal">
              <br>
              <form method="POST" onsubmit="setScroll();">
                <input type="hidden" name="scroll" value="0" id="scrollPos5">
                {% for key, value in track.__dict__.items() %}
                  <div class="e-div">
                    <label for="{{ guild.queue.index(track) }}_{{ key }}" class="e-label">{{ key }}</label>
                    <input type="text" id="{{ guild.queue.index(track) }}_{{ key }}" name="{{ key }}"
                           value="{{ value }}" class="e-input e-input-color">
                  </div>
                {% endfor %}
                <div class="e-div">
                  <button class="btn e-item1 btn-secondary btn-lg btn-m" type="button" data-bs-dismiss="modal"
                          aria-label="Close">{{ tg(gi, 'Close') }}</button>
                  <button class="btn e-item1 btn-primary btn-lg btn-m" type="submit" name="edit_btn"
                          value="{{ guild.queue.index(track) }}">{{ tg(gi, 'Submit') }}</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
    {% for track in guild.history %}
      <div class="modal fade" id="videoEditModal_h{{ guild.history.index(track) }}" data-bs-keyboard="false"
           tabindex="-1" aria-labelledby="videoEditLabel_h{{ guild.history.index(track) }}" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl r-modal">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5"
                  id="videoEditLabel{{ guild.history.index(track) }}">{{ tg(gi, 'Video History') }} {{ guild.history.index(track) }} {{ tg(gi, 'Edit') }}</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="info-modal modal-body">
              <br>
              <form method="POST" onsubmit="setScroll();">
                <input type="hidden" name="scroll" value="0" id="scrollPos9">
                {% for key, value in track.__dict__.items() %}
                  <div class="e-div">
                    <label for="{{ guild.history.index(track) }}_{{ key }}" class="e-label">{{ key }}</label>
                    <input type="text" id="{{ guild.history.index(track) }}_{{ key }}" name="{{ key }}"
                           value="{{ value }}" class="e-input e-input-color">
                  </div>
                {% endfor %}
                <div class="e-div">
                  <button class="btn e-item1 btn-secondary btn-lg btn-m" type="button" data-bs-dismiss="modal"
                          aria-label="Close">{{ tg(gi, 'Cancel') }}</button>
                  <button class="btn e-item1 btn-primary btn-lg btn-m" type="submit" name="edit_btn"
                          value="h{{ guild.history.index(track) }}">{{ tg(gi, 'Submit') }}</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
    {% if guild.now_playing %}
      <div class="modal fade" id="videoEditModal_np" data-bs-keyboard="false" tabindex="-1"
           aria-labelledby="videoEditLabel_np" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg r-modal">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="videoEditLabel_np">{{ tg(gi, 'Now playing Video Edit') }}</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="info-modal">
              <br>
              <form method="POST" onsubmit="setScroll();">
                <input type="hidden" name="scroll" value="0" id="scrollPos10">
                {% for key, value in guild.now_playing.__dict__.items() %}
                  <div class="e-div">
                    <label for="np_{{ key }}" class="e-label">{{ key }}</label>
                    <input type="text" id="np_{{ key }}" name="{{ key }}" value="{{ value }}"
                           class="e-input e-input-color">
                  </div>
                {% endfor %}
                <div class="e-div">
                  <button class="btn e-item1 btn-secondary btn-lg btn-m" type="button" data-bs-dismiss="modal"
                          aria-label="Close">{{ tg(gi, 'Cancel') }}</button>
                  <button class="btn e-item1 btn-primary btn-lg btn-m" type="submit" name="edit_btn"
                          value="np">{{ tg(gi, 'Submit') }}</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
  {% endif %}

  <!-- Modals -->
  <div class="modal fade" id="optionsModal" data-bs-keyboard="false" tabindex="-1" aria-labelledby="optionsLabel"
       aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg r-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="optionsLabel">Options</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form action="#" method="POST" onsubmit="setScroll();">
          <input type="hidden" name="scroll" value="0" id="scrollPos12">
          <div class="info-modal">
            <div class="e-div">
              <label for="loop" class="e-label">loop</label>
              <select class="e-input e-input-color" id="loop" name="loop">
                <option value="True" {{ 'selected' if guild.options.loop == True }}>True</option>
                <option value="False" {{ 'selected' if guild.options.loop == False }}>False</option>
              </select>
            </div>

            <div class="e-div">
              <label for="language" class="e-label">language</label>
              <select class="e-input e-input-color" id="language" name="language">
                {% for lang in languages_dict %}
                  <option value={{ lang }} {{ 'selected' if guild.options.language == lang }}>{{ lang }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="e-div">
              <label for="response_type" class="e-label">response_type</label>
              <select class="e-input e-input-color" id="response_type" name="response_type">
                <option value="short" {{ 'selected' if guild.options.response_type == 'short' }}>short</option>
                <option value="long" {{ 'selected' if guild.options.response_type == 'long' }}>long</option>
              </select>
            </div>

            <div class="e-div">
              <label for="buttons" class="e-label">buttons</label>
              <select class="e-input e-input-color" id="buttons" name="buttons">
                <option value="True" {{ 'selected' if guild.options.buttons == True }}>True</option>
                <option value="False" {{ 'selected' if guild.options.buttons == False }}>False</option>
              </select>
            </div>

            <div class="e-div">
              <label for="volume" class="e-label">volume (%)</label>
              <input type="number" id="volume" name="volume" value="{{ int(guild.options.volume * 100) }}" min="0" max="200"
                     class="e-input e-input-color">
            </div>

            <div class="e-div">
              <label for="buffer" class="e-label">buffer (s)</label>
              <input type="number" id="buffer" name="buffer" value="{{ guild.options.buffer }}" min="1" max="1800"
                     class="e-input e-input-color">
            </div>

            <div class="e-div">
              <label for="history_length" class="e-label">history_length</label>
              <input type="number" id="history_length" name="history_length" value="{{ guild.options.history_length }}" min="1" max="100"
                     class="e-input e-input-color">
            </div>

            <div class="e-div">
              <button class="btn e-item1 btn-secondary btn-lg btn-m" type="button" data-bs-dismiss="modal"
                      aria-label="Close">Cancel
              </button>
              <button class="btn e-item1 btn-primary btn-lg btn-m" type="submit" name="options_btn">Submit</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="modal fade" id="joinModal" data-bs-keyboard="false" tabindex="-1" aria-labelledby="joinLabel"
       aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="joinLabel">Join</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form method="POST" action="" onsubmit="setScroll();">
          <input type="hidden" name="scroll" value="0" id="scrollPos6">
          <div class="j-div">
            <label class="btn-m j-label">Channel ID</label>
            <div class="e-item2">
              <input type="number" class="form-control" name="channel_id">
            </div>
            <button type="submit" class="btn btn-primary" name="join_btn" value="id">{{ tg(gi, 'Join') }}</button>
          </div>
          {% if guild.data.voice_channels %}
            <div class="j-div">
              <label class="btn-m j-label">{{ tg(gi, 'Channel') }}</label>
              <div class="e-item2">
                <select class="form-select" aria-label="channel_name" name="channel_name">
                  {% for channel in guild.data.voice_channels %}
                    <option value="{{ channel['id'] }}">{{ channel['name'] }}</option>
                  {% endfor %}
                </select>
              </div>
              <button type="submit" class="btn btn-primary" name="join_btn" value="name">{{ tg(gi, 'Join') }}</button>
            </div>
          {% endif %}
        </form>
      </div>
    </div>
  </div>

  <div class="modal fade" id="addToModal" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel"
       aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="staticBackdropLabel">{{ tg(gi, 'Add to queue') }}</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form method="POST" id="ytForm" action="" onsubmit="setScroll();">
          <input type="hidden" name="scroll" value="0" id="scrollPos7">
          <div class="modal-body">
            <div class="mb-3">
              <label for="ytURL" class="btn-m">URL</label>
              <input type="text" class="form-control" name="ytURL" id="ytURL" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-dark" data-bs-dismiss="modal">{{ tg(gi, 'Close') }}</button>
            <button type="button" class="btn btn-secondary" data-bs-toggle="modal"
                    data-bs-target="#addToModalRadio">{{ tg(gi, 'Radio') }}</button>
            <button type="submit" class="btn btn-primary">{{ tg(gi, 'Add') }}</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="modal" id="addToModalRadio" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel"
       aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl r-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="staticBackdropLabelRadio">{{ tg(gi, 'Add to queue') }}</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form method="POST" id="RadioForm" action="" onsubmit="setScroll();">
          <input type="hidden" name="scroll" value="0" id="scrollPos8">
          <div class="e-div e-wrap">
            <button type="button" class="btn btn-dark e-item1" data-bs-dismiss="modal">{{ tg(gi, 'Close') }}</button>
            <button type="button" class="btn btn-secondary e-item1" data-bs-toggle="modal"
                    data-bs-target="#addToModal">{{ tg(gi, 'Video') }}</button>
            <!--                <button type="submit" class="btn btn-primary e-item1">Add</button>-->
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <div class="r-cards">
                {% for radio in radios %}
                  <div class="r-card">
                    <input type="radio" name='radio-checkbox' id="radio-checkbox{{ radio['id'] }}"
                           class="radio-checkbox" value="{{ radio['name'] }}"/>
                    <label for="radio-checkbox{{ radio['id'] }}" onclick="submitRadioForm()">
                      <img loading="lazy" src="/static/radio_svg/svg_radio_{{ radio['id'] }}.svg" class="r-img"
                           alt="radio_img_{{ radio['id'] }}">
                    </label>
                    <a class="radio-label">{{ radio['name'] }}</a>
                  </div>
                {% endfor %}
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="modal fade" id="saveModal" data-bs-keyboard="false" tabindex="-1" aria-labelledby="saveLabel"
       aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="saveLabel">{{ tg(gi, 'Save Queue') }}</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form method="POST" id="saveForm" action="" onsubmit="setScroll();">
          <input type="hidden" name="scroll" value="0" id="scrollPos14">
          <div class="modal-body">
            <div class="mb-3">
              <label for="saveName" class="btn-m">{{ tg(gi, 'Name') }}</label>
              <input type="text" class="form-control" name="saveName" id="saveName" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-dark" data-bs-dismiss="modal">{{ tg(gi, 'Close') }}</button>
            <button type="submit" class="btn btn-primary">{{ tg(gi, 'Save') }}</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="modal fade" id="loadModal" data-bs-keyboard="false" tabindex="-1" aria-labelledby="loadLabel"
       aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="loadLabel">{{ tg(gi, 'Load Queue') }}</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form method="POST" id="loadForm" action="" onsubmit="setScroll();">
          <input type="hidden" name="scroll" value="0" id="scrollPos15">
          <div class="modal-body">
            <div class="mb-3">
              {% if saves is not none %}
                <label for="loadName" class="btn-m">{{ tg(gi, 'Name') }}</label>
                <select class="form-select btn-m" aria-label="Default select example" name="loadName" id="loadName" required>
                  {% for save in saves %}
                    <option value="{{ save }}">{{ save }}</option>
                  {% endfor %}
                </select>
              {% else %}
                <p>{{ tg(gi, 'No saved queues') }}</p>
              {% endif %}
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-dark" data-bs-dismiss="modal">{{ tg(gi, 'Close') }}</button>
            {% if saves is not none %}
              <button type="submit" class="btn btn-primary">{{ tg(gi, 'Load') }}</button>
            {% endif %}
          </div>
        </form>
      </div>
    </div>
  </div>

  <script type="text/javascript" charset="utf-8">
  function convertSeconds(secs) {
      let hours = Math.floor(secs / 3600)
      let minutes = Math.floor((secs % 3600) / 60)
      let seconds = secs % 60

      function pad(num, totalLength) {
          return String(num).padStart(totalLength, '0');
      }

      if (hours) {
          return `${hours}:${pad(minutes, 2)}:${pad(seconds, 2)}`
      } else {
          return `${minutes}:${pad(seconds, 2)}`
      }
  }

  {% if guild.now_playing %}

  function getSecsPlayed(played_duration) {
      let len_played_duration = played_duration.length;
      if (len_played_duration === 0){
          return 0.0;
      }
      if (len_played_duration < 2){
          let start = played_duration[0]['start']['epoch'];
          let end = played_duration[0]['end']['epoch'];
          if (start === null){
              return 0.0;
          }
          if (end === null){
              return Math.round(Date.now() / 1000) - start;
          }
          return played_duration[0]['end']['time_stamp'];
      }

      let last_segment = played_duration[len_played_duration - 1];
      if (last_segment['end']['epoch'] != null){
          return last_segment['end']['time_stamp'];
      }

      let start_of_segment = last_segment['start']['epoch'];
      let start_of_segment_time = last_segment['start']['time_stamp'];
      return (Math.round(Date.now() / 1000) - start_of_segment) + start_of_segment_time;
  }

  function npProgress() {
      {% if check_isdigit(guild.now_playing.duration) %}
      let duration = {{ guild.now_playing.duration }};
      {% else %}
      let duration = null;
      {% endif %}

      let played_duration = {{ pd|safe }};
      let bar_elem = document.getElementById("np_progress");
      let text_elem = document.getElementById("progress_time");

      if (duration != null) {
          let sec_remaining = duration - getSecsPlayed(played_duration);

          if (Math.sign(sec_remaining) === -1) {
              bar_elem.style.width = 100 + '%';
              text_elem.innerText = convertSeconds(getSecsPlayed(played_duration));
          }
      }

      let inter = setInterval(addProgress, 1000);

      function addProgress() {
          text_elem.innerText = convertSeconds(getSecsPlayed(played_duration));

          if (duration != null) {
              let sec_remaining_add = duration - getSecsPlayed(played_duration);
              let percentage = 100 - (sec_remaining_add / duration) * 100;

              bar_elem.style.width = percentage + '%';

              if (percentage > 99.99 || sec_remaining_add < 2) {
                  clearInterval(inter);
                  setTimeout(function () {
                      location.reload();
                  }, 3000);
              }
          }
      }
  }

  npProgress();
  {% endif %}

  function httpGet(theUrl) {
      let xmlHttp = new XMLHttpRequest();
      xmlHttp.open("GET", theUrl, false); // false for synchronous request
      xmlHttp.send(null);
      return xmlHttp.responseText;
  }

  function getUpdate() {
      let url = 'http://' + document.domain + ':' + location.port + '/guild/{{guild.data.id}}/update';
      let response = Number(httpGet(url));
      if (response > last_update) {
          location.reload();
      }
  }

  function submitRadioForm(id) {
      let form = document.getElementById('RadioForm');
      let delayInMilliseconds = 100; //0.1 second

      setTimeout(function () {
          form.submit();
      }, delayInMilliseconds);
  }

  function setScroll() {
      let elements = ['scrollPos1', 'scrollPos2', 'scrollPos3', 'scrollPos4', 'scrollPos5', 'scrollPos6', 'scrollPos7', 'scrollPos8', 'scrollPos9', 'scrollPos10', 'scrollPos11', 'scrollPos12', 'scrollPos13', "scrollPos14", "scrollPos15"];
      for (let i = 0; i < elements.length; i++) {
          let elem = document.getElementById(elements[i]);
          if (elem) {
              elem.value = window.scrollY;
          }
      }

      onSubmitDisable()
  }

  function onSubmitDisable() {
      setTimeout(disableButtons, 10);

      function disableButtons() {
          let buttons = document.querySelectorAll(".btn");
          for (let i = 0; i < buttons.length; i++) {
              buttons[i].setAttribute('disabled', '');
          }
      }
  }

  function scrollNow(scroll_pos) {
      window.scrollTo({top: scroll_pos, left: 0, behavior: "instant"});
  }

  scrollNow({{scroll_position}})
  let last_update = Math.round(Date.now() / 1000);
  setInterval(getUpdate, 15000)
  </script>

{% endblock %}